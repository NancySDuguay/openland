  <% if @room != nil %>
    <% if cannot? :read, @room %>
    <div class="alert alert-info alert-dismissible" role="alert">
      <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
      <strong>Heads up!</strong> You need to sign in for using this room.
    </div>
    <% else %>
    <div id="room" data-url="<%= bbb_room_status_path(@room) %>" >
      <div id="room-top-bar">
        <%= link_to '', '#', id: "room-refresh", :name => "room-refresh", :title => 'Refresh', class: "btn btn-default glyphicon glyphicon-refresh pull-left" %>
        <%= link_to '', edit_room_path(@room), id: "room-edit", :name => "room-edit", :title => 'Edit', class: "btn btn-default glyphicon glyphicon-edit pull-right" %>
      </div><br>
      <div id="room-info">
        <h1><%= @room[:name] %></h1>
        <h3><%= @room[:description] %></h3>
      </div><br>
      <div id="room-status">
        <div id="room-status-general" class="alert alert-info" role="alert"></div>
        <div id="room-status-current"></div>
      </div><br>
      <div id="room-actionbar">
      <% if can? :use, @room %>
        <span id="room-enter" data-url="<%= bbb_room_enter_path(@room) %>"></span>
      <% end %>
      <% if can? :close, @room %>
        <span id="room-close" data-url="<%= bbb_room_close_path(@room) %>"></span>
      <% end %>
      </div><br>
    </div>
    <% end %>
    <% if @recordings.any? %>
    <div>
      <h3>Recordings</h3><br>
      <table id="recordings" class="table">
        <thead>
          <tr>
            <th>Recording</th>
            <th>Activity</th>
            <th>Description</th>
            <th>Date</th>
            <th>Duration</th>
            <% if can? :manage_recording, @room %>
            <th>Actions</th>
            <% end %>
          </tr>
        </thead>
        <tbody>
        <% @recordings.each do |recording| %>
          <tr>
            <td>
            <% recording[:playback][:format].each do |playback| %>
              <%= link_to playback[:type], playback[:url], id: "recording-"+playback[:type], :name => "recording-"+playback[:type], :title => "Playback "+playback[:type], class: "", :target => "_blank" %>
            <% end %>
            </td>
            <td><%= recording[:name] %></td>
            <td><%= recording[:metadata][:description]? recording[:metadata][:description]: 'none' %></td>
            <td><%= recording[:startTime].in_time_zone %></td>
            <td><%= to_duration(recording[:endTime].to_i - recording[:startTime].to_i).to_s %></td>
            <% if can? :manage_recording, @room %>
            <td>
              <span id="recording-delete-<%= recording[:recordID] %>" data-url="<%= bbb_recording_delete_path(recording[:recordID]) %>">Actions</span>
            </td>
            <% end %>
          </tr>
        <% end %>
        </tbody>
      </table>
    </div>
    <% end %>
  <% end %>

<script>
$(document).ready(function($) {
    initButtonRoomRefresh ();
    initButtonRoomEnter ();
    initButtonRoomClose ();
    refreshRoom ();
    $('#recordings').dataTable ({
        sPaginationType : "full_numbers"
    });
});
</script>
